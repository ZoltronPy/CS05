{% extends "form.html" %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height: calc(100vh - 56px);">
    <div class="card shadow-sm p-4" style="width: 100%; max-width: 600px;">
        <h2 class="mb-4 text-center">Rezervace zájezdu</h2>

        <!-- Nadpis s názvem zájezdu -->
        <h3 class="text-center">{{ trip.tour_name }}</h3>

        <form method="post" novalidate>
            {% csrf_token %}

            <!-- Chybová hlášení -->
            {% if errors %}
            <div class="alert alert-danger">
                <ul>
                    {% for error in errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- Jméno -->
            <div class="mb-3">
                <label for="name" class="form-label">Jméno</label>
                <input type="text" class="form-control" id="name" name="name" value="{{ form_data.name }}" required>
            </div>

            <!-- E-mail -->
            <div class="mb-3">
                <label for="email" class="form-label">E-mail</label>
                <input type="email" class="form-control" id="email" name="email" value="{{ form_data.email }}" required>
            </div>

            <!-- Počet dospělých -->
            <div class="mb-3">
                <label for="adults" class="form-label">Počet dospělých</label>
                <input type="number" class="form-control" id="adults" name="adults" value="{{ form_data.adults }}" min="0">
            </div>

            <!-- Počet dětí -->
            <div class="mb-3">
                <label for="kids" class="form-label">Počet dětí</label>
                <input type="number" class="form-control" id="kids" name="kids" value="{{ form_data.kids }}" min="0">
            </div>

            <!-- Souhrn rezervace -->
            <div class="mb-4 text-center">
                <h4>Souhrn zájezdu</h4>
                <div class="d-flex flex-column align-items-center">
                <p><strong>Destinace:</strong> {{ trip.tour_name }}</p>
                <p><strong>Cena za dospělého:</strong> {{ trip.price_per_adult }} Kč</p>
                <p><strong>Cena za dítě:</strong> {{ trip.price_per_child }} Kč</p>
                <p><strong>Celková cena:</strong> <span id="total-price">0</span> Kč</p>
            </div>
</div>

            <!-- Tlačítko pro odeslání -->
            <div class="d-flex justify-content-center">
            <button type="submit" class="btn btn-primary">Potvrdit rezervaci</button>
            </div>
        </form>
    </div>
</div>

<!-- JavaScript for Price Calculation -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const adultsInput = document.getElementById('adults');
        const kidsInput = document.getElementById('kids');
        const totalPriceDisplay = document.getElementById('total-price');

        const pricePerAdult = parseFloat("{{ trip.price_per_adult }}") || 0;
        const pricePerChild = parseFloat("{{ trip.price_per_child }}") || 0;

        // Funkce pro výpočet celkové ceny
        function calculatePrice() {
            const adults = parseInt(adultsInput.value) || 0;
            const kids = parseInt(kidsInput.value) || 0;

            const totalPrice = (adults * pricePerAdult) + (kids * pricePerChild);
            totalPriceDisplay.textContent = totalPrice.toLocaleString('cs-CZ'); // Formát CZK
        }

        // Eventy na vstupních polích
        adultsInput.addEventListener('input', calculatePrice);
        kidsInput.addEventListener('input', calculatePrice);

        // Počáteční výpočet
        calculatePrice();
    });
</script>
{% endblock %}
